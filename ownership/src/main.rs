//æ‰€æœ‰æƒè§„åˆ™*******************Rustçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€***********************é‡è¦æŒ‡æ•°ï¼šðŸ’–ðŸ’–ðŸ’–ðŸ’–ðŸ’–

//é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‰€æœ‰æƒçš„è§„åˆ™ã€‚å½“æˆ‘ä»¬é€šè¿‡ä¸¾ä¾‹è¯´æ˜Žæ—¶ï¼Œè¯·è°¨è®°è¿™äº›è§„åˆ™ï¼š

//Rust ä¸­çš„æ¯ä¸€ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºå…¶ æ‰€æœ‰è€…ï¼ˆownerï¼‰çš„å˜é‡ã€‚
//å€¼åœ¨ä»»ä¸€æ—¶åˆ»æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚
//å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒã€‚

use std::io;

//å˜é‡ä½œç”¨åŸŸ
fn main() {
    let important_counter = "ðŸ’– ðŸ’– ðŸ’– ðŸ’– ðŸ’–:";
    println!("\næ³¨:æœ¬ç« è¯¾ç¨‹ä¸ºRustæ‰€æœ‰æƒåŠŸèƒ½(ownership),é‡è¦æŒ‡æ•°:{important_counter}");
    
    //è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„æ—¶é—´ç‚¹ï¼š
    //å½“ s è¿›å…¥ä½œç”¨åŸŸ æ—¶ï¼Œå®ƒå°±æ˜¯æœ‰æ•ˆçš„ã€‚
    //è¿™ä¸€ç›´æŒç»­åˆ°å®ƒ ç¦»å¼€ä½œç”¨åŸŸ ä¸ºæ­¢ã€‚
    {//æ··æ²Œ
    let mut _s = "æ•¦ç…Œ"; //å‡ºç”Ÿ
    }//æ­»äº¡

    //ownershipä»¥Stringç±»åž‹ä¸ºä¾‹
    println!("è¯·è¾“å…¥:>");
    let mut str = String::new();
    io::stdin().read_line(&mut str).unwrap();
    println!("ä½ è¾“å…¥çš„å­—ç¬¦ä¸²ä¸º:{}",str);

    let mut str2:String = String::from("ç©ºä¸å¼‚è‰²ï¼Œè‰²ä¸å¼‚ç©º");
    str2.push_str("ã€‚ç©ºå³æ˜¯è‰²ï¼Œè‰²å³æ˜¯ç©ºã€‚");
    println!("{}",str2);

    //å­—ç¬¦ä¸²å­—é¢é‡å’ŒStringä¸­Stringå¯å˜è€Œå­—é¢é‡å´ä¸è¡Œ,åŒºåˆ«åœ¨äºŽä¸¤ä¸ªç±»åž‹å¯¹å†…å­˜çš„å¤„ç†ä¸Šã€‚

    //å¯¹äºŽ String ç±»åž‹ï¼Œä¸ºäº†æ”¯æŒä¸€ä¸ªå¯å˜ï¼Œå¯å¢žé•¿çš„æ–‡æœ¬ç‰‡æ®µï¼Œéœ€è¦åœ¨å †ä¸Šåˆ†é…ä¸€å—åœ¨ç¼–è¯‘æ—¶æœªçŸ¥å¤§å°çš„å†…å­˜æ¥å­˜æ”¾å†…å®¹ã€‚è¿™æ„å‘³ç€ï¼š
    //å¿…é¡»åœ¨è¿è¡Œæ—¶å‘å†…å­˜åˆ†é…å™¨è¯·æ±‚å†…å­˜ã€‚
    //éœ€è¦ä¸€ä¸ªå½“æˆ‘ä»¬å¤„ç†å®Œ String æ—¶å°†å†…å­˜è¿”å›žç»™åˆ†é…å™¨çš„æ–¹æ³•ã€‚
    
    //ä¸€ã€ç¬¬ä¸€éƒ¨åˆ†ç”±æˆ‘ä»¬å®Œæˆï¼šå½“è°ƒç”¨ String::from æ—¶ï¼Œå®ƒçš„å®žçŽ°ï¼ˆimplementationï¼‰è¯·æ±‚å…¶æ‰€éœ€çš„å†…å­˜ã€‚è¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­æ˜¯éžå¸¸é€šç”¨çš„ã€‚
    //äºŒã€å†…å­˜å›žæ”¶ã€‚æ–¹æ³•ä¸€ã€GC;æ–¹æ³•äºŒã€allocreate&free;è€ŒRusté‡‡ç”¨äº†ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œå°±æ˜¯â€˜å†…å­˜åœ¨æ‹¥æœ‰å®ƒçš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸåŽå°±è¢«è‡ªåŠ¨é‡Šæ”¾â€™ã€‚
    //å¦‚ï¼š
    {
        let my_str = String::from("é‡‡èŠä¸œç¯±ä¸‹ï¼Œæ‚ ç„¶è§å—å±±");    //my_strå¼€å§‹æœ‰æ•ˆ
        println!("{}", my_str);     //ä½¿ç”¨
        //drop(my_str);
    }       //æ­¤ä½œç”¨åŸŸç»“æŸ
            //my_strä¸å†æœ‰æ•ˆ

    //è¿™æ˜¯ä¸€ä¸ªå°† String éœ€è¦çš„å†…å­˜è¿”å›žç»™åˆ†é…å™¨çš„å¾ˆè‡ªç„¶çš„ä½ç½®ï¼š
    // å½“ s ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ã€‚å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸï¼ŒRust ä¸ºæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚
    // è¿™ä¸ªå‡½æ•°å«åš dropï¼Œåœ¨è¿™é‡Œ String çš„ä½œè€…å¯ä»¥æ”¾ç½®é‡Šæ”¾å†…å­˜çš„ä»£ç ã€‚
    // Rust åœ¨ç»“å°¾çš„ } å¤„è‡ªåŠ¨è°ƒç”¨ dropã€‚

    //å˜é‡ä¸Žæ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆä¸€ï¼‰ï¼šç§»åŠ¨
    let x = 7;
    let y = x;
    println!("{:?}",x);
    println!("{:?}",y);

    let s1 = String::from("ä¹±èŠ±æ¸æ¬²è¿·äººçœ¼ï¼Œæµ…è‰æ‰èƒ½æ²¡é©¬è¹„");
    let s2 = s1;
    //println!("{}",s1);
    println!("{}",s2);
    //å¦‚æžœä½ åœ¨å…¶ä»–è¯­è¨€ä¸­å¬è¯´è¿‡æœ¯è¯­ æµ…æ‹·è´ï¼ˆshallow copyï¼‰å’Œ æ·±æ‹·è´ï¼ˆdeep copyï¼‰ï¼Œé‚£ä¹ˆæ‹·è´æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡è€Œä¸æ‹·è´æ•°æ®å¯èƒ½å¬èµ·æ¥åƒæµ…æ‹·è´ã€‚
    //ä¸è¿‡å› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡æ— æ•ˆäº†ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸º ç§»åŠ¨ï¼ˆmoveï¼‰ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚

    //å¦å¤–ï¼Œè¿™é‡Œè¿˜éšå«äº†ä¸€ä¸ªè®¾è®¡é€‰æ‹©ï¼šRust æ°¸è¿œä¹Ÿä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„ â€œæ·±æ‹·è´â€ã€‚å› æ­¤ï¼Œä»»ä½• è‡ªåŠ¨ çš„å¤åˆ¶å¯ä»¥è¢«è®¤ä¸ºå¯¹è¿è¡Œæ—¶æ€§èƒ½å½±å“è¾ƒå°ã€‚

    //å˜é‡ä¸Žæ•°æ®äº¤äº’çš„æ–¹å¼ï¼ˆäºŒï¼‰ï¼šå…‹éš†
    //å¦‚æžœæˆ‘ä»¬ ç¡®å®ž éœ€è¦æ·±åº¦å¤åˆ¶ String ä¸­å †ä¸Šçš„æ•°æ®ï¼Œè€Œä¸ä»…ä»…æ˜¯æ ˆä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš clone çš„é€šç”¨å‡½æ•°ã€‚
    let s3 = String::from("æœ€çˆ±æ¹–ä¸œè¡Œä¸è¶³ï¼Œç»¿æ¨è«é‡Œç™½æ²™å ¤");
    let s4 = s3.clone();
    println!("s3:{:?} AND s4:{:?}",s3,s4);

    //Copy trait:
        //ä»»ä½•ä¸€ç»„ç®€å•æ ‡é‡å€¼çš„ç»„åˆéƒ½å¯ä»¥å®žçŽ° Copyï¼Œä»»ä½•ä¸éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»åž‹éƒ½å¯ä»¥å®žçŽ° Copy ã€‚å¦‚ä¸‹æ˜¯ä¸€äº› Copy çš„ç±»åž‹.

    //å¦‚ä¸‹æ˜¯ä¸€äº› Copy çš„ç±»åž‹ï¼š
    // æ‰€æœ‰æ•´æ•°ç±»åž‹ï¼Œæ¯”å¦‚ u32ã€‚
    // å¸ƒå°”ç±»åž‹ï¼Œboolï¼Œå®ƒçš„å€¼æ˜¯ true å’Œ falseã€‚
    // æ‰€æœ‰æµ®ç‚¹æ•°ç±»åž‹ï¼Œæ¯”å¦‚ f64ã€‚
    // å­—ç¬¦ç±»åž‹ï¼Œcharã€‚
    // å…ƒç»„ï¼Œå½“ä¸”ä»…å½“å…¶åŒ…å«çš„ç±»åž‹ä¹Ÿéƒ½å®žçŽ° Copy çš„æ—¶å€™ã€‚æ¯”å¦‚ï¼Œ(i32, i32) å®žçŽ°äº† Copyï¼Œä½† (i32, String) å°±æ²¡æœ‰ã€‚


    // *æ‰€æœ‰æƒä¸Žå‡½æ•°******************************
    //å°†å€¼ä¼ é€’ç»™å‡½æ•°åœ¨è¯­ä¹‰ä¸Šä¸Žç»™å˜é‡èµ‹å€¼ç›¸ä¼¼ã€‚å‘å‡½æ•°ä¼ é€’å€¼å¯èƒ½ä¼šç§»åŠ¨æˆ–è€…å¤åˆ¶ï¼Œå°±åƒèµ‹å€¼è¯­å¥ä¸€æ ·ã€‚

    let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

    takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                  // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ
    //println!("{}", s);    XXX

    let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

     makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                  // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åŽé¢å¯ç»§ç»­ä½¿ç”¨ x
    println!("{}",x);

    //************************è¿”å›žå€¼ä¸Žä½œç”¨åŸŸ*****************************************************************/
    let _s1 = gives_ownership();         // gives_ownership å°†è¿”å›žå€¼
                                                // ç§»ç»™ s1
    let s2 = String::from("hello");     // s2 è¿›å…¥ä½œç”¨åŸŸ                    
    
    let _s3 = takes_and_gives_back(s2);  // s2 è¢«ç§»åŠ¨åˆ°
                                      // takes_and_gives_back ä¸­,
                                      // å®ƒä¹Ÿå°†è¿”å›žå€¼ç§»ç»™ s3

    //*************************è½¬ç§»è¿”å›žå€¼çš„æ‰€æœ‰æƒ*************************************************************/
    let s1 = String::from("hello");

    let (s2, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s2, len);

}// è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åŽæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

  // è¿™é‡Œ, s3 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚s2 ä¹Ÿç§»å‡ºä½œç”¨åŸŸï¼Œä½†å·²è¢«ç§»èµ°ï¼Œ
  // æ‰€ä»¥ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿã€‚s1 ç§»å‡ºä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ

//æ‰€æœ‰æƒä¸Žå‡½æ•°
fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_string);
} // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾
  
fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
    println!("{}", some_integer);
} // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

//è¿”å›žå€¼ä¸Žä½œç”¨åŸŸ
fn gives_ownership() -> String {           // gives_ownership å°†è¿”å›žå€¼ç§»åŠ¨ç»™
    // è°ƒç”¨å®ƒçš„å‡½æ•°

let some_string = String::from("yours"); // some_string è¿›å…¥ä½œç”¨åŸŸ

some_string                              // è¿”å›ž some_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}
// takes_and_gives_back å°†ä¼ å…¥å­—ç¬¦ä¸²å¹¶è¿”å›žè¯¥å€¼
fn takes_and_gives_back(a_string: String) -> String { // a_string è¿›å…¥ä½œç”¨åŸŸ

    a_string  // è¿”å›ž a_string å¹¶ç§»å‡ºç»™è°ƒç”¨çš„å‡½æ•°
}

//è½¬ç§»è¿”å›žå€¼çš„æ‰€æœ‰æƒ
fn calculate_length(s: String) -> (String, usize) {
    let length = s.len(); // len() è¿”å›žå­—ç¬¦ä¸²çš„é•¿åº¦

    (s, length)
}